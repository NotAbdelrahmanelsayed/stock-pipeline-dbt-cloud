import pytest
import pandas as pd
from io import StringIO


@pytest.fixture(scope="module")
def transformed_data():
    csv_data = """Date,Ticker,Open,High,Low,Close,Volume
                2025-06-13,AAPL,199.72999572753906,200.3699951171875,195.77000427246094,196.4499969482422,50778564
                2025-06-13,AMZN,209.9600067138672,214.0500030517578,209.66000366210938,212.10000610351562,29278801
                2025-06-13,AVGO,250.66000366210938,254.0,248.3699951171875,248.6999969482422,18307585
                2025-06-13,BRK-B,486.2699890136719,491.08428955078125,485.8900146484375,487.5400085449219,3129046
                2025-06-13,GOOGL,172.44000244140625,177.1300048828125,172.38499450683594,174.6699981689453,27594804
                2025-06-13,META,687.2000122070312,694.5499877929688,681.010009765625,682.8699951171875,9245769
                2025-06-13,MSFT,476.17999267578125,479.17999267578125,472.79998779296875,474.9599914550781,16796830
                2025-06-13,NVDA,142.47999572753906,143.5800018310547,140.85499572753906,141.97000122070312,177854288
                2025-06-13,TSM,210.11000061035156,213.25999450683594,209.39999389648438,211.10000610351562,10127792
                2025-06-15,2222.SR,25.0,25.5,25.0,25.399999618530273,28768190
                """

    return pd.read_csv(StringIO(csv_data))


@pytest.fixture(scope="module")
def raw_data():
    messy_csv = """Ticker,TSM,TSM,TSM,TSM,TSM,2222.SR,2222.SR,2222.SR,2222.SR,2222.SR,AMZN,AMZN,AMZN,AMZN,AMZN,NVDA,NVDA,NVDA,NVDA,NVDA,BRK-B,BRK-B,BRK-B,BRK-B,BRK-B,AVGO,AVGO,AVGO,AVGO,AVGO,META,META,META,META,META,MSFT,MSFT,MSFT,MSFT,MSFT,GOOGL,GOOGL,GOOGL,GOOGL,GOOGL,AAPL,AAPL,AAPL,AAPL,AAPL
                Price,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume,Open,High,Low,Close,Volume
                Date,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
                2025-06-13,210.11,213.26,209.40,211.10,10127792,,,,,,209.96,214.05,209.66,212.10,29278801,142.48,143.58,140.85,141.97,177854288,486.27,491.08,485.89,487.54,3129046,250.66,254.00,248.37,248.70,18307585,687.20,694.55,681.01,682.87,9245769,476.18,479.18,472.80,474.96,16796830,172.44,177.13,172.38,174.67,27594804,199.73,200.37,195.77,196.45,50778564
                2025-06-15,,,,,,25.0,25.5,25.0,25.4,28768190,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
                """
    return pd.read_csv(StringIO(messy_csv), header=[0, 1, 2])


@pytest.fixture(scope="module")
def filepath():
    return "raw_test_stock_prices_20250614_20250615.csv"
